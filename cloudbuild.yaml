steps:
  # Verificar configuraci√≥n
  - name: "bash"
    script: |
      #!/bin/bash
      echo "üîç Verificando configuraci√≥n..."
      if [ ! -f "app.yaml" ]; then
        echo "‚ùå app.yaml no encontrado"
        exit 1
      fi
      if [ ! -f "main.py" ]; then
        echo "‚ùå main.py no encontrado"
        exit 1
      fi
      echo "‚úÖ Archivos de configuraci√≥n encontrados"

  # Instalar dependencias
  - name: "python:3.11-slim"
    entrypoint: pip
    args: ["install", "-r", "requirements.txt", "--user", "--quiet"]

  # Ejecutar pruebas (opcional - deshabilitado por defecto)
  # - name: "python:3.11-slim"
  #   entrypoint: python
  #   args: ["-m", "pytest", "test_*.py", "-v", "--tb=short"]
  #   env:
  #     - "FLASK_ENV=test"

  # Verificar sintaxis de Python
  - name: "python:3.11-slim"
    entrypoint: python
    args: ["-m", "py_compile", "main.py", "app/__init__.py"]

  # Desplegar a App Engine
  - name: "gcr.io/google.com/cloudsdktool/cloud-sdk"
    entrypoint: gcloud
    args:
      - "app"
      - "deploy"
      - "--version=${_VERSION:-prod}"
      - "--quiet"
      - "--no-promote"

# Configuraci√≥n de variables de sustituci√≥n
substitutions:
  _VERSION: prod

# Configuraci√≥n de timeout
timeout: "1800s"

# Configuraci√≥n de opciones
options:
  machineType: "E2_HIGHCPU_8"
  logging: CLOUD_LOGGING_ONLY

# Configuraci√≥n de logs
logsBucket: "gs://${PROJECT_ID}-logs"
